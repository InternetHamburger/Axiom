TODO:
- Fix castle bug



IDEAS:
- Speed up checking for check with ray masks